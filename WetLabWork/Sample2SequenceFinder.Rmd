---
title: "Finding a Sample to Sequence"
author: "Nicholas F. Brazeau"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  html_document:
    highlight: textmate
    theme: lumen
    toc: yes
    toc_float: yes
    toc_depth: 2
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, message = F)

source("~/Documents/GitHub/VivID_Epi/R/00-functions_basic.R") 
library(tidyverse)
load("~/Documents/GitHub/VivID_Epi/data/vividepi_recode.rda")


pvpcr <- readr::read_csv(file="/Volumes/share/1. Data/2. Data Set Processing/CD2013DHS_Adults_Construction/Pv_alladults_v1.csv", 
                         col_names = T) %>% 
  magrittr::set_colnames(tolower(colnames(.))) %>% 
  dplyr::select(-c(dplyr::starts_with("hiv0")))


```

# Where's Waldo

We would like to find a sample that we can put on the sequencer from the CD2013 DHS that is _Pvivax_ positive and some modicum of success.  

### Background 
Originally tried sWGA with NFB and Cowell primers. Failed with hypothesized high levels of jackpotting.

### First/Second Round
On June 26, 2018, Zack finished library prep and hybrid selection of 3 samples (quiagen extraction). Each sample underwent no amplification and WGA (non-specific) followed by hybrid selection with a tier 3 SureSelect bait. No amplification versus WGA was used to determine allele frequency bias. Failed due to ? On October 22, 2018, we tried a hybrid capture of the 

## New Sample Identification
There are `r nrow(dt)` samples with geospatial data of the original `r nrow(pvpcr)` samples with qPCR data. See [here](https://docs.google.com/drawings/d/1WNlvJXyDtylk265QrHoGI2qjeSd3ZHF92MQFwJdhGUo/edit?usp=sharing) for an explanation of how data was subsetted. 

### Big Table
```{r}

dtsub <- dt %>% 
  dplyr::select(c("hivrecode_barcode", "pfldh", "po18s"))

dplyr::inner_join(pvpcr, dtsub, by = "hivrecode_barcode") %>% 
  dplyr::left_join(x=., y= tibble(hivrecode_barcode = tolower(c("D6E7U", "Y5I1N", "I1A1K")), tried = rep("Y", 3))) %>% 
  dplyr::mutate(tried = ifelse(is.na(tried), "N", tried)) %>% 
  dplyr::filter(pv18s == 1) %>% 
  dplyr::mutate(corrected_ct = round(corrected_ct, 2)) %>% 
  DT::datatable(., extensions='Buttons',
               options = list(
              searching = T,
              pageLength = 20,
              dom = 'Bfrtip', 
              buttons = c('csv')))


# in dhs D6E7V is D6E7U
# in dhs Y5L1N is Y5I1N

```

### Smaller Table
```{r}

dtsub <- dt %>% 
  dplyr::select(c("hivrecode_barcode", "pfldh", "po18s"))

dplyr::inner_join(pvpcr, dtsub, by = "hivrecode_barcode") %>% 
  dplyr::left_join(x=., y= tibble(hivrecode_barcode = tolower(c("D6E7U", "Y5I1N", "I1A1K")), tried = rep("Y", 3))) %>% 
  dplyr::mutate(tried = ifelse(is.na(tried), "N", tried)) %>% 
  dplyr::filter(pv18s == 1) %>% 
  dplyr::select(c("hivrecode_barcode", "corrected_ct", "pv18s", "pfldh", "po18s", "tried", "plate", "rowlett", "columnnum")) %>% 
  dplyr::mutate(corrected_ct = round(corrected_ct, 2)) %>% 
  DT::datatable(., extensions='Buttons',
               options = list(
              searching = T,
              pageLength = 20,
              dom = 'Bfrtip', 
              buttons = c('csv')))


# in dhs D6E7V is D6E7U
# in dhs Y5L1N is Y5I1N

```

