--- 
title: "Sensitivity Cutoff CT<42, Univariate and Bivariate Analyses" 
author: "Nicholas F. Brazeau" 
date: "`r format(Sys.time(), '%B %d, %Y')`" 
output: 
  html_document: 
    highlight: tango 
    theme: lumen 
    toc: yes 
    toc_float: yes 
    toc_depth: 3 
    code_folding: hide
editor_options:  
  chunk_output_type: console
--- 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)

source("~/Documents/GitHub/VivID_Epi/analyses/00-functions_glms.R") 
library(tidyverse)
library(sf)
library(srvyr) #wrap the survey package in dplyr syntax
devtools::install_github("kaz-yos/tableone")
library(tableone)
#......................
# Import Data
#......................
load("~/Documents/GitHub/VivID_Epi/data/vividepi_recode.rda")
load("~/Documents/GitHub/VivID_Epi/reports/report_obj/03-Uni_Bivar_analyses_SENS.rda")

options(scipen=999)
```


## Exposure of Interests
The variables that I care about as potential risk factors are: 


SURVEY CHARACERISTICS

  1. hv005, cluster level weights
  2. Date of Sample Collection, hv016, hv006, hv007 *

COINFECTIONS/BIOMARKER VARIABLES 

  1. pfldh coinfection
  2. po18s coinfection 
  3. Currently pregnant? (HA54)
  4. HIV Status (HIV03)
  5. Hemoglobin Level adjust for altitude and smoking (HA56 & HB56). 


SOCIOECOLOGICAL VARIABLES

  1. Type of Residence i.e. Rural or Urban (HV025)
  2. Drinking Water (categorical: HV201)
  3. Non-Drinking water (categorical: HV202)
  4. Main floor material (categorical: HV213)
  5. Main wall material (categorical: HV214)
  6. Main roof material (categorical: HV215)
  7. Shares toilet with other household (HV225)
  8. Wealth Index (HV270)
  9. Biological Sex (HV104)
  10. Age (HV105)
  11. Highest year of education completed (continous: HV107) 
  12. Number of Children Under 5

MALARIA-INTERVENTIONS

  1. Person slept under an LLIN net (HML20)
  2. LLIN Insecticide Type 

PHYSICAL/LANDSCAPE/CLIMATE VARIABLES

  1. Cluster altitude (HV040) 
  2. Rainfall 
  3. Temparature 


#### Considerations for Bednets
The way the DHS was set up based on the [Malaria Indicator Survey Questionnaire -- 	06 MIS Interviewers Manual ](http://malariasurveys.org/toolkit.cfm) the way questions are answered is as follows (loosely):   

  1. Person from house bring the interviewer all the nets   
  2. Then they ask when net obtained, TYPE and BRAND of bednet, source of net  
  2. Then they ask if the net was ever treated since they have owned   
  3. NEXT they ask who slept under the bednet in two part. Did you sleep under an ever treated net. And did person sleep under an LLIN net -- this is what is used to link the data to the survey    
  
   
Type of Bednet exposure: 
[WHO Recommended LLIN](http://who.int/whopes/Long-lasting_insecticidal_nets_April_2016.pdf) 
[Permanet 2.0](http://www.vestergaard.com/permanet-2-0)  
[Olyset](http://sumivector.com/mosquito-nets/olyset-net)  
[Duranet](http://duranetllin.com/)  
[Interceptor](http://duranetllin.com/)  
[Yorkool](http://www.treated-bednet.eu/yorkool_ln.html)  
[LifeNet](https://www.cropscience.bayer.us/news/press-releases/2012/lifenet-mosquito-nets-now-available)  
[MAGNet](http://www.mosquitomagnet.com/store/mosquito-magnet-accessories/nets)  
[Serena](http://hzsn.en.alibaba.com/product/1664650287-200124492/Serena_long_lasting_insecticide_treated_nets_LLINs_Mosquito_Net_coated_with_WHOPES_approved_Insecticide_Treated_Mosquito_Net.html)  
[Netprotect](http://www.insectcontrol.net/permanent_partnership/index.php)   
  

# Non-parametric, Bivariate Analysis for _P. vivax_
For potential risk factors, these are the nx2 tables for categorical variables and mean/t-test for continuous.
```{r}

tableone::kableone(pvtbl1) %>% 
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"))

```
### Considerations
Only really odd thing I did here was collable by months. This is the number of days in each month that was considered above. **A lot more people sampled in December, so don't think it is indicative of a seasonal cause**. 
```{r}

dt %>% 
  group_by(hvyrmnth_fctm) %>% 
  summarise(n=n()) %>% 
    knitr::kable(., "html") %>%
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),  position = "center")

```


# Parametric, Bivariate Analysis
Odds Ratios with Pv as the outcome.


## Estimates

```{r}
est <- do.call("rbind", model_parameters$glmlogit_tidy)

est %>% 
  dplyr::filter(term != "(Intercept)") %>% 
  mutate_if(is.numeric, round, 2) %>% 
  dplyr::rename(PvOR = estimate) %>% 
  dplyr::filter(PvOR > 0 ) %>% # convergence issue. for now
  knitr::kable(., "html") %>%  # note must tell kableExtra html or latex
  kableExtra::kable_styling(bootstrap_options = "striped", full_width = F, position = "center")
  


```
##

# Parametric, Bivariate Analysis, Province Level Random Effect
Odds Ratios with Pv as the outcome. Note, these aren't exponentiated estimates. So they are logit-odds (long story. Will fix eventually).

## Estimates
```{r}

est2 <- do.call("rbind", model_parameters$glmlogit_mlm_tidy)

est2 %>% 
  dplyr::filter(term != "(Intercept)") %>% 
  dplyr::bind_rows(.) %>% 
  mutate_if(is.numeric, round, 2) %>% 
  dplyr::rename(PvOR = estimate) %>% 
  dplyr::filter(PvOR > 0 ) %>% # convergence issue. for now
  knitr::kable(., "html") %>%  # note must tell kableExtra html or latex
  kableExtra::kable_styling(bootstrap_options = c("striped", "hover", "condensed", "responsive"),  position = "center")

```
##





