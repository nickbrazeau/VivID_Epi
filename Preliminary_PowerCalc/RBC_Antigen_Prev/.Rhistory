dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1) %>%
dplyr::summarise(n=n(),
weightedn = sum(overallwt),
wtmutprev=survey::svymean(),
wtmutsd = survey::svyvar(),
wtL95CI = mutprev - 1.96*(wtmutsd/sqrt(weightedn)),
wtU95CI = mutprev + 1.96*(wtmutsd/sqrt(weightedn))) %>%
mutate_if(is.numeric, funs(round(., 2)))
dhs13_sub
dhs13_sub$mut <- rbinom(n = 1, size=length(dhs13_sub))
dhs13_sub$mut <- rbinom(n = 1, size=length(dhs13_sub), prob=0.5)
dhs13_sub
dhs13_sub$mut <- rbinom(n =length(dhs13_sub), size=1, prob=0.5)
dhs13_sub
#dhs13_sub_sum <-
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(pv_pos == 1,
sampleweight * (1/case_fraction),
sampleweight * (1/noncase_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1) %>%
dplyr::summarise(n=n(),
weightedn = sum(overallwt),
wtmutprev=survey::svymean(),
wtmutsd = survey::svyvar(),
wtL95CI = mutprev - 1.96*(wtmutsd/sqrt(weightedn)),
wtU95CI = mutprev + 1.96*(wtmutsd/sqrt(weightedn))) %>%
mutate_if(is.numeric, funs(round(., 2)))
dhs13_sub_sum_design <-
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(pv_pos == 1,
sampleweight * (1/case_fraction),
sampleweight * (1/noncase_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1)
design <- survey::svydesign(ids=dhs13_sub_sum_design$barcode,
weights=dhs13_sub_sum_design$overallwt,
data=dhs13_sub_sum_design)
dhs13_sub_sum_design$overallwt
summary(dhs13_sub_sum_design$overallwt)
View(dhs13_sub_sum_design)
dhs13_sub_sum_design <-
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1)
design <- survey::svydesign(ids=dhs13_sub_sum_design$barcode,
weights=dhs13_sub_sum_design$overallwt,
data=dhs13_sub_sum_design)
design
svymean(~mut,design)
dhs13_sub_sum_design
View(dhs13_sub_sum_design)
1/0.06
sum(dhs13_sub_sum_design$wt_mut)/sum(dhs13_sub_sum_design$overallwt)
svymean(~mut,design)
?s
?sd
install.packages("Hmisc")
library(Hmisc)
dhs13_sub_sum_design <-
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1)
dhs13_sub_sum_design
design <- survey::svydesign(ids=dhs13_sub_sum_design$barcode,
weights=dhs13_sub_sum_design$overallwt,
data=dhs13_sub_sum_design)
svymean(~mut,design)
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1) %>%
dplyr::summarise(n=n(),
weightedn = sum(overallwt),
wtmutprev=Hmisc::wtd.mean()
wtmutsd = survey::svyvar(),
wtL95CI = mutprev - 1.96*(wtmutsd/sqrt(weightedn)),
wtU95CI = mutprev + 1.96*(wtmutsd/sqrt(weightedn))) %>%
mutate_if(is.numeric, funs(round(., 2)))
svymean(~mut,design)
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1)
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1)
dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::group_by(NAME_1) %>%
dplyr::summarise(n=n(),
weightedn = sum(overallwt),
wtmutprev=Hmisc::wtd.mean()
wtmutsd = survey::svyvar(),
wtL95CI = mutprev - 1.96*(wtmutsd/sqrt(weightedn)),
wtU95CI = mutprev + 1.96*(wtmutsd/sqrt(weightedn))) %>%
mutate_if(is.numeric, funs(round(., 2)))
dhs13_sub <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
)) %>%
dplyr::mutate(wt_mut = mut*overallwt) %>%
dplyr::mutate(NAME_1 = provname)
View(dhs13_sub)
dhs13_sub$mut
dhs13_sub <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
dhs13_sub <- sample_n(dhs13_short, 1000)
dhs13_sub <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
dhs13_sub
design <- survey::svydesign(ids=dhs13_sub$barcode,
weights=dhs13_sub$overallwt,
data=dhs13_sub)
svyby(~mut,~NAME_1,design,svymean)
svyby
?svyby
design <- survey::svydesign(ids=dhs13_sub$barcode,
weights=dhs13_sub$overallwt,
data=dhs13_sub)
svyby(~mut,~NAME_1,design,svymean)
design
dhs13_sub <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
svymean(~mut,design)
dhs13_sub <- sample_n(dhs13_short,1000)
dhs13_sub_wt <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
design <- survey::svydesign(ids=dhs13_sub_wt$barcode,
weights=dhs13_sub_wt$overallwt,
data=dhs13_sub_wt)
dhs13_sub_wt$sampleweight
dhs13_sub_wt$wt
dhs13_sub$mut <- rbinom(n=1, size=1000)
dhs13_sub$mut <- rbinom(n=1, size=1000, prob=0.5)
mean(dhs13_sub$mut)
dhs13_sub$mut <- rbinom(n=1000, size=1, prob=0.5)
mean(dhs13_sub$mut)
dhs13_sub_wt <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
design <- survey::svydesign(ids=dhs13_sub_wt$barcode,
weights=dhs13_sub_wt$overallwt,
data=dhs13_sub_wt)
svyby(~mut,~NAME_1,design,svymean)
svyby(~mut,~NAME_1,design,svytotal)
dhs13_sub_wt_svyby <- svyby(~mut,~NAME_1,design,svymean)
dhs13_sub_wt_svyby
dhs13_sub_wt_sum <- svyby(~mut,~NAME_1,design,svymean)
# Get province-specific means
dhs2007prevprov_weighted <- svyby(~pfcall,~shnprovin,design07,svymean)
dhs13_sub_wt_sum <- dhs13_sub_wt_sum %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
mutate_if(is.numeric, funs(round(., 2)))
survey::svy
# setup
dhs13_mapdf <- DRCprov %>%
dplyr::left_join(x=., y = dhs13_sub_wt_sum, by="NAME_1") %>%
dplyr::mutate(prov = NAME_1)
plotObj <- ggplot() +
geom_sf(data=dhs13_mapdf, aes(fill = mutprev)) +
scale_fill_gradientn("Mutation \n Prev", colours = c("#d0d1e6", "#3690c0", "#253494")) +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
plot.title =  element_blank(),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.position = "bottom",
legend.title = element_text(size=16, family = "Arial", face="bold"),
legend.title.align=0.5,
legend.text = element_text(size=14, family = "Arial", face="bold", hjust=0.5, vjust=0.5, angle=90)
)
tbl <- gridExtra::tableGrob(dhs13_sub_wt_sum, rows=NULL, theme = tt2)
tt2 <- ttheme_default(core = list(fg_params=list(cex = 0.9)),
colhead=list(fg_params = list(cex=0.9)))
tbl <- gridExtra::tableGrob(dhs13_sub_wt_sum, rows=NULL, theme = tt2)
gridExtra::grid.arrange(plotObj, tbl,
ncol=2)
dhs13_sub_wt_sum <- dhs13_sub_wt_sum %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
mutate_if(is.numeric, funs(round(., 2)))
# setup
dhs13_mapdf <- DRCprov %>%
dplyr::left_join(x=., y = dhs13_sub_wt_sum, by="NAME_1") %>%
dplyr::mutate(prov = NAME_1)
plotObj <- ggplot() +
geom_sf(data=dhs13_mapdf, aes(fill = mutprev)) +
scale_fill_gradientn("Mutation \n Prev", colours = c("#d0d1e6", "#3690c0", "#253494")) +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
plot.title =  element_blank(),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.position = "bottom",
legend.title = element_text(size=16, family = "Arial", face="bold"),
legend.title.align=0.5,
legend.text = element_text(size=14, family = "Arial", face="bold", hjust=0.5, vjust=0.5, angle=90)
)
tt2 <- ttheme_default(core = list(fg_params=list(cex = 0.9)),
colhead=list(fg_params = list(cex=0.9)))
tbl <- gridExtra::tableGrob(dhs13_sub_wt_sum, rows=NULL, theme = tt2)
tbl$widths <- unit(rep(1/(ncol(tbl)), ncol(tbl)), "npc")
tbl$heights <- unit(rep(1/(nrow(tbl)), nrow(tbl)), "npc")
gridExtra::grid.arrange(plotObj, tbl,
ncol=2)
plotObj <- ggplot() +
geom_sf(data=dhs13_mapdf, aes(fill = mut)) +
scale_fill_gradientn("Mutation \n Prev", colours = c("#d0d1e6", "#3690c0", "#253494")) +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
plot.title =  element_blank(),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.position = "bottom",
legend.title = element_text(size=16, family = "Arial", face="bold"),
legend.title.align=0.5,
legend.text = element_text(size=14, family = "Arial", face="bold", hjust=0.5, vjust=0.5, angle=90)
)
tt2 <- ttheme_default(core = list(fg_params=list(cex = 0.9)),
colhead=list(fg_params = list(cex=0.9)))
tbl <- gridExtra::tableGrob(dhs13_sub_wt_sum, rows=NULL, theme = tt2)
tbl$widths <- unit(rep(1/(ncol(tbl)), ncol(tbl)), "npc")
tbl$heights <- unit(rep(1/(nrow(tbl)), nrow(tbl)), "npc")
gridExtra::grid.arrange(plotObj, tbl,
ncol=2)
dhs13_sub_wt_sum <- svyby(~mut,~NAME_1,design,svymean)
dhs13_sub_wt_sum <- dhs13_sub_wt_sum %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
mutate_if(is.numeric, funs(round(., 2)))
# setup
dhs13_mapdf <- DRCprov %>%
dplyr::left_join(x=., y = dhs13_sub_wt_sum, by="NAME_1") %>%
dplyr::mutate(prov = NAME_1)
plotObj <- ggplot() +
geom_sf(data=dhs13_mapdf, aes(fill = mut)) +
scale_fill_gradientn("Mutation \n Prev", colours = c("#d0d1e6", "#3690c0", "#253494")) +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
plot.title =  element_blank(),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.position = "bottom",
legend.title = element_text(size=16, family = "Arial", face="bold"),
legend.title.align=0.5,
legend.text = element_text(size=14, family = "Arial", face="bold", hjust=0.5, vjust=0.5, angle=90)
)
tt2 <- ttheme_default(core = list(fg_params=list(cex = 0.9)),
colhead=list(fg_params = list(cex=0.9)))
tbl <- gridExtra::tableGrob(dhs13_sub_wt_sum, rows=NULL, theme = tt2)
tbl$widths <- unit(rep(1/(ncol(tbl)), ncol(tbl)), "npc")
tbl$heights <- unit(rep(1/(nrow(tbl)), nrow(tbl)), "npc")
gridExtra::grid.arrange(plotObj, tbl,
ncol=2)
# setup
dhs13_mapdf <- DRCprov %>%
dplyr::left_join(x=., y = dhs13_sub_wt_sum, by="NAME_1") %>%
dplyr::mutate(prov = NAME_1)
dhs13_mapdf
dhs13_mapdf
plotObj <- ggplot() +
geom_sf(data=dhs13_mapdf, aes(fill = mut)) +
scale_fill_gradientn("Mutation \n Prev", colours = c("#d0d1e6", "#3690c0", "#253494")) +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
plot.title =  element_blank(),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.position = "bottom",
legend.title = element_text(size=16, family = "Arial", face="bold"),
legend.title.align=0.5,
legend.text = element_text(size=14, family = "Arial", face="bold", hjust=0.5, vjust=0.5, angle=90)
)
plotObj
##----------------------------------##
##            Read-In Data          ##
##----------------------------------##
load("~/Documents/GitHub/VivID_PhD_Thesis/Preliminary_PowerCalc/RBC_Antigen_Prev/data.RData")
dhs13_sub <- sample_n(dhs13_short,1000)
dhs13_sub$mut <- 1
dhs13_sub_wt <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
dhs13_sub_wt
design <- survey::svydesign(ids=dhs13_sub_wt$barcode,
weights=dhs13_sub_wt$overallwt,
data=dhs13_sub_wt)
dhs13_sub_wt_sum <- svyby(~mut,~NAME_1,design,svymean)
dhs13_sub_wt_sum
dhs13_sub_wt_sum <- dhs13_sub_wt_sum %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
mutate_if(is.numeric, funs(round(., 2)))
dhs13_sub_wt_sum
dhs13_sub_wt_sum <- dhs13_sub_wt_sum %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
dplyr::mutate(wtU95CI = mut + 1.96*se) %>%
mutate_if(is.numeric, funs(round(., 2)))
# setup
dhs13_mapdf <- DRCprov %>%
dplyr::left_join(x=., y = dhs13_sub_wt_sum, by="NAME_1")
dhs13_sub_wt_sum
ggplot() +
geom_sf(data=dhs13_mapdf, aes(fill = mut)) +
scale_fill_gradientn("Mutation \n Prev", colours = c("#d0d1e6", "#3690c0", "#253494")) +
theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
panel.border = element_blank(),
plot.title =  element_blank(),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title.y = element_blank(),
axis.text.x = element_blank(),
axis.title.x = element_blank(),
legend.position = "bottom",
legend.title = element_text(size=16, family = "Arial", face="bold"),
legend.title.align=0.5,
legend.text = element_text(size=14, family = "Arial", face="bold", hjust=0.5, vjust=0.5, angle=90)
)
dhs13_sub_wt <- dhs13_sub %>%
dplyr::left_join(x=., y=provdict, by = "shnprovin") %>%
dplyr::mutate(NAME_1 = provname) %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
design <- survey::svydesign(ids=dhs13_sub_wt$barcode,
weights=dhs13_sub_wt$overallwt,
data=dhs13_sub_wt)
dhs13_sub_wt_sum <- svyby(~mut,~NAME_1,design,svymean)
dhs13_sub_wt_sum <- dhs13_sub_wt_sum %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
dplyr::mutate(wtU95CI = mut + 1.96*se) %>%
mutate_if(is.numeric, funs(round(., 2)))
# setup
dhs13_mapdf <- DRCprov %>%
dplyr::left_join(x=., y = dhs13_sub_wt_sum, by="NAME_1")
dhs13_sub_wt_sum
str(dhs13_sub_wt_sum)
dhs13_sub_wt
dhs13_sub_wt_sum <- as.tibble(dhs13_sub_wt_sum) %>%
dplyr::mutate(wtL95CI = mut - 1.96*se) %>%
dplyr::mutate(wtU95CI = mut + 1.96*se) %>%
mutate_if(is.numeric, funs(round(., 2)))
dhs13_sub_wt_sum
# setup
dhs13_mapdf <- DRCprov %>%
dplyr::left_join(x=., y = dhs13_sub_wt_sum, by="NAME_1")
dhs13_mapdf$mut
dhs13_sub$shnprovin
dhs13_sub_sum <- svyby(~mut,~shnprovin,design,svymean)
dhs13_sub_sum
provdict
dhs13_sub %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
dhs13_sub
dhs13_sub %>%
dplyr::group_by(shnprovin) %>%
summarise(n=n(),
wtn = n())
dhs13_sub %>%
dplyr::group_by(shnprovin) %>%
summarise(n=n(),
wtn = sum(overallwt))
dhs13_sub <- dhs13_sub %>%
dplyr::mutate(case_fraction = 1) %>%
dplyr::mutate(noncase_fraction = nrow(dhs13_sub[dhs13_sub$pv_pos==0, ]) / nrow(dhs13_short[dhs13_short$pv_pos==0, ]) ) %>%
dplyr::mutate(overallwt = ifelse(c(pv_pos == 0 | is.na(pv_pos)),
sampleweight * (1/noncase_fraction),
sampleweight * (1/case_fraction)
))
dhs13_sub %>%
dplyr::group_by(shnprovin) %>%
summarise(n=n(),
wtn = sum(overallwt))
